{% load humanize %}

<button class="ui secondary button details {{ menuitem }}_{{ building.id }}">Details</button>
<div class="ui modal details {{ menuitem }}_{{ building.id }}">
    <div class="header">
        {{ building.name }}
    </div>
    <div class="scrolling content">
        <div class="description">
            <div class="ui pointing secondary menu">
                <a class="item active" data-tab="specifications"><i class="bar chart icon"></i>Specifications</a>
                {% for workType_CODE, menuitem in WORK_CHOICES %}
                <a class="item" data-tab="{{ workType_CODE }}">
                    {% if workType_CODE == 'CW' %}
                    <i class="wrench icon"></i>
                    {% elif workType_CODE == 'MW' %}
                    <i class="tasks icon"></i>
                    {% endif %}
                    {{ menuitem }} Works
                </a>
                {% endfor %}
            </div>
            <div class="ui tab basic segment active" data-tab="specifications">
                <div class="ui two column centered grid">
                    <div class="twelve wide column">
                        <table class="ui definition table">
                            <tbody>
                                <tr>
                                    <td class="six wide">{{ menuitem }} Name</td>
                                    <td class="name">{% if building.name %} {{ building.name }} {% endif %}</td>
                                </tr>

                                <tr>
                                    <td>Date Issued</td>
                                    <td class="dateIssued">{% if building.dateIssued %} {{ building.dateIssued }}
                                        {% endif %}</td>
                                </tr>

                                <tr>
                                    <td>Date Construction Started</td>
                                    <td class="dateConstructionStarted">{% if building.dateConstructionStarted %}
                                        {{ building.dateConstructionStarted }} {% endif %}</td>
                                </tr>

                                <tr>
                                    <td>Date Construction Completed</td>
                                    <td class="dateConstructionCompleted">{% if building.dateConstructionCompleted %}
                                        {{ building.dateConstructionCompleted }} {% endif %}</td>
                                </tr>

                                <tr>
                                    <td>Date Operational</td>
                                    <td class="dateOperational">{% if building.dateOperational %}
                                        {{ building.dateOperational }}
                                        {% endif %}</td>
                                </tr>

                                <tr>
                                    <td>Construction Cost (Estimated)</td>
                                    <td class="constructionCostEstimated">{% if building.constructionCostEstimated %}
                                        ₹&nbsp;{{ building.constructionCostEstimated|intcomma }} {% endif %}</td>
                                </tr>

                                <tr>
                                    <td>Construction Cost (Actual)</td>
                                    <td class="constructionCostActual">{% if building.constructionCostActual %}
                                        ₹&nbsp;{{ building.constructionCostActual|intcomma }} {% endif %}</td>
                                </tr>

                                <tr>
                                    <td>Area</td>
                                    <td class="area">{% if building.area %} {{ building.area }} acres {% endif %}</td>
                                </tr>

                                <tr>
                                    <td>Number of Rooms</td>
                                    <td class="numRooms">{% if building.numRooms %} {{ building.numRooms }} {% endif %}
                                    </td>
                                </tr>

                                <tr>
                                    <td>Number of Washrooms</td>
                                    <td class="numWashrooms">{% if building.numWashrooms %} {{ building.numWashrooms }}
                                        {% endif %}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                {% if building.remarks %}
                <h4 class="ui horizontal divider header">
                    <i class="sticky note icon"></i>
                    Remarks
                </h4>
                <div class="ui two column centered grid">
                    <div class="twelve wide column">
                        <p>{{ building.remarks }}</p>
                    </div>
                </div>
                {% endif %}

            </div>
            {% for workType_CODE, menuitem in WORK_CHOICES %}
            <div class="ui tab basic segment" data-tab="{{ workType_CODE }}">
                {% if building.MW_List|length > 0 and workType_CODE == 'MW' or building.CW_List|length > 0 and workType_CODE == 'CW' %}
                <table class="ui selectable celled sortable table">
                    <thead>
                        <tr>
                            <th class="five wide column">{{ menuitem }} Work Name</th>
                            <th class="two wide column">Issued Date</th>
                            <th class="two wide column right aligned">Estimated Cost</th>
                            <th colspan="2" class="one wide column"></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for work in building.work_set.all %}
                        {% if work.workType == workType_CODE %}

                        <tr>
                            <td>
                                {{ work.name }}
                            </td>
                            <td class="center aligned">
                                {{ work.dateIssued }}
                            </td>
                            <td class="right aligned">
                                ₹&nbsp;{{ work.costEstimated|intcomma }}
                            </td>
                            <td class="center aligned">
                                {% include 'estate_module/Work/edit_button.html' %}
                            </td>
                            <td class="center aligned">
                                {% include 'estate_module/Work/detail.html' %}
                            </td>
                        </tr>

                        {% endif %}
                        {% endfor %}
                    </tbody>
                    <tfoot>
                        <tr>
                            <th colspan="6">
                                <button
                                    class="ui right floated right labeled icon blue new_{{ menuitem }}_{{ building.id }} button">
                                    <i class="plus icon"></i>
                                    New
                                </button>
                            </th>
                        </tr>
                    </tfoot>
                </table>

                {% else %}
                <div class="ui two column centered grid">
                    <div class="row">
                        <div class="ui icon warning compact message">
                            <i class="database icon"></i>
                            <div class="content">
                                <div class="header">
                                    No {{ menuitem }} Work found for {{ building.name }}
                                </div>
                                {% comment %} <p>Get the best news in your e-mail every day.</p> {% endcomment %}
                            </div>
                        </div>

                    </div>
                    <div class="row">
                        <button class="ui right labeled icon blue new_{{ menuitem }}_{{ building.id }} button">
                            <i class="plus icon"></i>
                            New
                        </button>
                    </div>
                </div>
                {% endif %}

                <script>
                    $('.new_{{ menuitem }}_{{ building.id }}.button').on('click', function () {
                        $('.new_{{ menuitem }}.modal')
                            .modal({
                                centered: false
                            })
                            .modal({
                                onShow: function () {
                                    // prefill form
                                    $('.new_{{ menuitem }}.modal form')
                                        .form('set values', {
                                            workType: '{{ workType_CODE }}',
                                            building: '{{ building.id }}',
                                        });
                                }
                            })
                            .modal('setting', 'closable', false)
                            .modal('show');
                    });
                </script>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="actions">
        <div class="ui black deny large button">
            Close
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $('.{{ menuitem }}_{{ building.id }}.details.modal')
            .modal({
                centered: false
            })
            .modal('setting', 'closable', false)
            .modal('attach events', '.{{ menuitem }}_{{ building.id }}.details.button',
                'show');
    });
</script>

{% comment %}

<div class="ui modal details">
    {% include 'estate/estate_detail.html' %}
</div>

{{ buildings|json_script:"buildings-data" }}

<script>
    $('.details.button').on('click', function (e) {
        //const id = Number($(this).attr("data-id"));
        const id = e.target.attributes["data-id"].nodeValue;
        const estate = JSON.parse(document.getElementById('buildings-data').textContent)[id];

        $('.details.modal')
            .modal({
                onShow: function () {
                    $('.details.modal .header')
                        .text(building.name);
                    $('.details.modal tbody td#{{ menuitem }}_date_approval')
                        .text(building.date_approval);
                    $('.details.modal tbody td#{{ menuitem }}_date_start')
                        .text(building.date_start);
                    $('.details.modal tbody td#{{ menuitem }}_amount')
                        .text("₹ " + building.amount)
                }
            })
            .modal('show');
    });
</script>

{% endcomment %}