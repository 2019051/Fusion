{% load static %}
{% block messbill %}

    {% comment %}The tab menu starts here!{% endcomment %}
    <div class="ui pointing secondary menu">
        <a class="ui active item" data-tab="bills">
            Update Cost
        </a>

        <a class="item" data-tab="generatebill">
            Generate Bill
        </a>

    </div>


    <div class="ui active tab" data-tab="bills" id="messmonthlybill">
        <div class="ui vertical segment">
            <form method="post">
                {% csrf_token %}
                <div class="ui form" style="padding: 8px; padding-left: 24px; padding-right: 24px;">
                    <div class="two fields">
                        <div class="field">
                            <label>Enter bill amount for the current month</label>
                            <input name="amount" id="amount" type="number">
                        </div>
                    </div>
                    <div class="field">
                        <button class="ui primary button right floated" type="submit" name="submit"
                                onclick="updatecost()">Update
                        </button>
                    </div>
                </div>
                <br>
            </form>
        </div>
    </div>

    <div class="ui tab" data-tab="generatebill" id="generatebill">
        <div class="ui vertical segment">
            <form method="post" action="{% url 'mess:generatemessbill' %}">
                {% csrf_token %}
                <div>
                    <button class="ui primary button right floated" type="submit" name="submit">
                        Generate
                    </button>
                </div>
                <div>
                    <label>Bill generation will take a while please hold on and don't refresh</label>
                </div>
            </form>

        </div>
    </div>

{% endblock %}
{% block javascript %}
    <script type="text/javascript" src="{% static 'globals/js/jquery.min.js' %}"></script>

    <script>
        function updatecost() {
            $.ajax({
                type: 'POST',
                url: 'updatecost/',
                dataType: 'json',
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'amount': $("#amount").val()
                },
                success: function (data) {
                    if (data.status) {
                        alert("Data Inserted Successfully");
                        $("#messmonthlybill").load(location.href + " #messmonthlybill>*", "")
                    }
                },
                error: function (data, err) {
                    alert(err.message);
                }
            });
            return false;
        }

        function generatemessbill() {
            $.ajax({
                type: 'POST',
                url: 'generatemessbill/',
                dataType: 'json',
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                },
                success: function (data) {
                    if (data.status) {
                        alert("Bills Generated Successfully");
                        $("#generatebill").load(location.href + " #generatebill>*", "")
                        <!--$("#messmonthlybill").load(location.href+" #messmonthlybill>*","")-->
                    }
                },
                error: function (data, err) {
                    alert(err.message);
                    $("#generatebill").load(location.href + " #generatebill>*", "")
                }
            });
            return false;
        }


    </script>
{% endblock %}
